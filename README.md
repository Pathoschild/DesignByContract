**`Pathoschild.DesignByContract`** is a little aspect-oriented library
which enables design-by-contract preconditions and postconditions on method
arguments and return values. By annotating methods with attributes like
`[NotNull]`, you can eliminate boilerplate validation logic while enabling
helpful exception messages and making your code much more robust and
refactor-safe. These annotation attributes are also recognized by
[ReSharper](http://www.jetbrains.com/resharper/) (if you use it), which
provides you with feedback on contract violations in realtime as you type code.

The library is built on top of [PostSharp](http://www.sharpcrafters.com/), a
proprietary and commercial framework that requires a license for use. However,
the library carefully only uses features available as part of the
[free Starter License](http://www.sharpcrafters.com/purchase/compare).

**This is an early proof of concept, and shouldn't really be used in production yet.**

##Example
The following code block *with* the annotations:

        [DesignedByContract]
        public class Sword
        {
            [return: NotNull]
            public string Hit([NotNull] string actor, [NotNull] string target)
            {
                return String.Format("{0} hit {1} with a sword!", actor, target);
            }
        }

is equivalent to this one *without* the annotations:

        public class Sword
        {
            public string Hit(string actor, string target)
            {
                if (actor == null)
                    throw new ArgumentNullException("actor", "The value cannot be null for parameter 'actor' of method 'Sword::Hit'.");
                if (String.IsNullOrWhiteSpace(actor))
                    throw new ArgumentException("The value cannot be blank or consist entirely of whitespace for parameter 'actor' of method 'Sword::Hit'.", "actor");

                if (target == null)
                    throw new ArgumentNullException("target", "The value cannot be null for parameter 'target' of method 'Sword::Hit'.");
                if (String.IsNullOrWhiteSpace(target))
                    throw new ArgumentException("The value cannot be blank or consist entirely of whitespace for parameter 'target' of method 'Sword::Hit'.", "target");

                string value = String.Format("{0} hit {1} with a sword!", actor, target);
                
                if(value == null)
                    throw new NullReferenceException("The return value cannot be null for method 'Sword::Hit'.");
                if(String.IsNullOrWhiteSpace(value))
                    throw new InvalidOperationException("The return value cannot be blank or consist entirely of whitespace for method 'Sword::Hit'.");
                
                return value;
            }
        }

## Annotations
The following annotations are currently implemented:

* `[NotNull]`:
  * on a method argument, throws `ArgumentNullException` if a `null` value is
    passed, or `ArgumentException` if a blank or whitespace-only value is passed.
  * on a method or method return value, throws `NullReferenceException` if a
    `null` value is returned, or `InvalidOperationException` if a blank or
    whitespace-only value is passed.

## Performance
Decent performance is a core design goal for this library — it was originally
written for use in a large multi-tenant enterprise application. The
`[DesignedByContract]` aspect does all its reflection at compile time, so
it's very fast when the code is actually run.

For example, this is the (cleaned up) decompiled source code generated by the `Sword` example above:

        public string Hit([NotNull] string actor, [NotNull] string target)
        {
            MethodExecutionArgs args = new MethodExecutionArgs((object) null, (Arguments) new Arguments<string, string>() { Arg0 = actor, Arg1 = target });

            Sword.\u003C\u003Ez__Aspects.a0.OnEntry(args);
            string str = string.Format("{0} hit {1} with a sword!", actor, target);
            args.ReturnValue = str;

            Sword.\u003C\u003Ez__Aspects.a0.OnSuccess(args);
            return str;
        }